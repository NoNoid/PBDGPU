/*@AUTO_GENERATED_WARNING@*/

#include <kernels.hpp>
#include <util/functions.hpp>

static const string simulationParametersHeader(
R"END(
@SIMULATION_PARAMETERS_HEADER@
)END");

static const string predictionSource(
R"END(
@PREDICTION_KERNEL@
)END");

static const string updateSource(
R"END(
@UPDATE_KERNEL@
)END");

static const string kernelCollSource(
R"END(
@PLANE_COLL_KERNEL@
)END");

static const string particleHeader(
R"END(
@PARTICLE_HEADER@
)END");

static const string distanceConstraintDataHeader(
R"END(
@DISTANCE_CONSTRAINT_DATA_HEADER@
)END");

static const string bendingConstraintDataHeader(
R"END(
@BENDING_CONSTRAINT_DATA_HEADER@
)END");

static const string triangleBendingConstraintDataHeader(
R"END(
@TRIANGLE_BENDING_CONSTRAINT_DATA_HEADER@
)END");

static const string distanceConstraintKernelSource(
R"END(
@DISTANCE_CONSTRAINT_KERNEL_SOURCE@
)END");

static const string bendingConstraintKernelSource(
R"END(
@BENDING_CONSTRAINT_KERNEL_SOURCE@
)END");

static const string triangleBendingConstraintKernelSource(
R"END(
@TRIANGLE_BENDING_CONSTRAINT_KERNEL_SOURCE@
)END");

static const string atomicFloatFunctions(
R"END(
@ATOMIC_FLOAT_FUNCTIONS@
)END");

static const string postSolveUpdateSource(
R"END(
@POST_SOLVE_UPDATE_SOURCE@
)END");

static const string postStabilizationUpdateSource(
R"END(
@POST_STABILIZATION_UPDATE_SOURCE@
)END");

string getCompilerOptions() {
    string result("-D cl_float4=float4 -D cl_float3=float3 -D cl_float=float -D cl_int=int -D cl_uint=uint");

#ifdef PBDGPU_DEBUG_PRINT
    result += " -D PBDGPU_DEBUG_PRINT";
#endif

#ifdef PBDGPU_DEBUG_PRINT_KERNEL
    result += " -D PBDGPU_DEBUG_PRINT_KERNEL";
#endif

    return result;
}

cl_kernel pbdgpu::buildPredictionKernel(cl_context context,cl_device_id device)
{

    return pbdgpu::createKernel(particleHeader + simulationParametersHeader + predictionSource,getCompilerOptions(),"prediction",context,device);
}

cl_kernel pbdgpu::buildUpdateKernel(cl_context context, cl_device_id device)
{
    return pbdgpu::createKernel(particleHeader+simulationParametersHeader+updateSource,getCompilerOptions(),"update",context,device);
}

cl_kernel pbdgpu::buildPlaneCollisionKernel(cl_context context,cl_device_id device)
{
    return pbdgpu::createKernel(particleHeader+simulationParametersHeader+kernelCollSource,getCompilerOptions(),"planeCollision",context,device);
}

cl_kernel pbdgpu::buildDistanceConstraintKernel(cl_context context, cl_device_id device)
{
    return pbdgpu::createKernel(particleHeader+simulationParametersHeader+distanceConstraintDataHeader+atomicFloatFunctions+distanceConstraintKernelSource,getCompilerOptions(),"distanceConstraint",context,device);
}

cl_kernel pbdgpu::buildBendingConstraintKernel(cl_context context, cl_device_id device)
{
    return pbdgpu::createKernel(particleHeader+simulationParametersHeader+bendingConstraintDataHeader+atomicFloatFunctions+bendingConstraintKernelSource,getCompilerOptions(),"bendingConstraint",context,device);
}

cl_kernel pbdgpu::buildPostSolveUpdateKernel(cl_context context, cl_device_id device)
{
    return pbdgpu::createKernel(postSolveUpdateSource,getCompilerOptions(),"postSolveUpdate",context,device);
}

cl_kernel pbdgpu::buildPostStabilizationUpdateKernel(cl_context context, cl_device_id device)
{
    return pbdgpu::createKernel(particleHeader+postStabilizationUpdateSource,getCompilerOptions(),"postStabilizationUpdate",context,device);
}

cl_kernel pbdgpu::buildTriangleBendingKernel(cl_context context, cl_device_id device)
{
    return pbdgpu::createKernel(
            particleHeader+
            simulationParametersHeader+
            triangleBendingConstraintDataHeader+
            atomicFloatFunctions+
            triangleBendingConstraintKernelSource,
            getCompilerOptions(),"triangleBendingConstraint",context,device);
}